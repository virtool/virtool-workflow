version: "3.1"
services:
  redis:
    image: redis:6.0
    ports:
      - "6379"
    volumes:
      - vt_redis_data:/data
    logging:
      driver: none

  pytest:
    build:
      dockerfile: tests/Dockerfile
      context: ..
    command: >
      --cov --cov-report xml:/test/coverage/coverage.xml
      --disable-pytest-warnings --redis-url redis://redis:6379
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./coverage:/test/coverage
    depends_on: [redis]

volumes:
  vt_redis_data:
